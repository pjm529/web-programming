<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="BoardDAO">
	
	<resultMap type="BoardVO" id="boardMap">
		<id		column="idx"			property="idx" />
		<result column="title"			property="title" />
		<result column="content"		property="content" />
		<result column="writer_id"		property="writerId" />
		<result column="writer_name"	property="writerName" />
		<result column="regist_date"	property="registDate" />
		<result column="modify_date"	property="modifyDate" />
	</resultMap>
	
	<select id="selectBoardList" parameterType="hashmap" resultMap="boardMap">
		<![CDATA[
			SELECT 
				B.*, U.name AS writer_name
			FROM 
				tb_board B INNER JOIN tb_user U ON B.writer_id = U.user_id
		]]>
			<where>
				<if test="title != ''">
					B.title LIKE CONCAT('%', #{title}, '%')	
				</if>
			</where>			
		<![CDATA[
			ORDER BY B.idx
			LIMIT #{startList}, #{listSize}
		]]>
	</select>
	
	<select id="selectBoardListCnt" parameterType="string" resultType="int">
		<![CDATA[
			SELECT
				COUNT(*)
			FROM
				tb_board
		]]>
			<where>
				<if test="value != ''"> <!-- 단일 이라서 value씀 -->
					title LIKE CONCAT('%', #{title}, '%')
				</if>
			</where>
	</select>
	
	<select id="selectBoard" parameterType="long" resultMap="boardMap">
		<![CDATA[
			SELECT 
				B.*, U.name AS writer_name
			FROM 
				tb_board B INNER JOIN tb_user U ON B.writer_id = U.user_id
			WHERE
				B.idx = #{idx}
		]]>
	</select>
	
	<insert id="insertBoard" parameterType="BoardVO">
		<![CDATA[
			INSERT INTO tb_board
				(title, content, writer_id)
			VALUE
				(#{title}, #{content}, #{writerId})
		]]>		
	</insert>
	
	<delete id="deleteBoard" parameterType="long">
		<![CDATA[
			DELETE FROM tb_board
			WHERE 
				idx = #{idx}
		]]>
	</delete>
	
	<update id="updateBoard" parameterType="BoardVO">
		<![CDATA[
			UPDATE tb_board
			SET
				title = #{title},
				content = #{content},
				modify_date = NOW()
			WHERE
				idx = #{idx}
		]]>
	</update>
</mapper>